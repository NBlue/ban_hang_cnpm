{"ast":null,"code":"var _jsxFileName = \"D:\\\\Dev\\\\banhang\\\\client\\\\src\\\\pages\\\\Success.js\",\n    _s = $RefreshSig$();\n\nimport { useEffect, useState } from \"react\";\nimport { useSelector, useDispatch } from \"react-redux\";\nimport { deleteCart } from \"../redux/cartRedux\";\nimport { useLocation } from \"react-router\";\nimport { userRequest } from \"../requestMethod\";\nimport { Link } from \"react-router-dom\";\nimport { setPoint } from \"./../redux/userRedux\";\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\n\nconst Success = () => {\n  _s();\n\n  const dispatch = useDispatch();\n  const location = useLocation(); //in Cart.jsx I sent data and cart. Please check that page for the changes.(in video it's only data)\n\n  const data = location.state.stripeData;\n  const cart = location.state.products;\n  const value = location.state.value;\n  const currentUser = useSelector(state => state.user.currentUser);\n  const point = useSelector(state => state.user.point);\n  let level = point / 1000000;\n  if (level < 1) level = 0;\n  if (1 <= level && level < 2) level = 1;\n  if (level < 3 && level >= 2) level = 2;\n  if (level >= 3) level = 3;\n  const [orderId, setOrderId] = useState(null);\n  console.log(currentUser);\n\n  const deleCart = () => {\n    dispatch(deleteCart());\n  };\n\n  useEffect(() => {\n    const createOrder = async () => {\n      try {\n        const res = await userRequest.post(\"/orders\", {\n          userId: currentUser._id,\n          products: cart.products.map(item => ({\n            productId: item._id,\n            quantity: item._quantity\n          })),\n          amount: cart.total * (1 - value) + 50000 - level * 10000,\n          address: data\n        });\n        console.log(res.data + \"null\");\n        setOrderId(res.data._id);\n      } catch {}\n    };\n\n    const updateUser = async () => {\n      try {\n        const newpoint = currentUser.point + cart.total * (1 - value) + 50000 - level * 10000;\n        dispatch(setPoint(newpoint));\n        const res1 = await userRequest.put(`/users/${currentUser._id}`, {\n          point: newpoint\n        });\n        console.log(res1.data);\n      } catch {\n        console.log('loi updateuser');\n      }\n    };\n\n    data && createOrder();\n    data && updateUser();\n  }, [cart, data, currentUser]);\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    style: {\n      height: \"100vh\",\n      display: \"flex\",\n      flexDirection: \"column\",\n      alignItems: \"center\",\n      justifyContent: \"center\"\n    },\n    children: [orderId ? `Order has been created successfully. Your order number is ${orderId}` : `Successfull. Your order is being prepared...`, /*#__PURE__*/_jsxDEV(Link, {\n      to: \"/\",\n      children: /*#__PURE__*/_jsxDEV(\"button\", {\n        style: {\n          padding: 10,\n          marginTop: 20\n        },\n        onClick: deleCart,\n        children: \"Go to Homepage\"\n      }, void 0, false, {\n        fileName: _jsxFileName,\n        lineNumber: 75,\n        columnNumber: 21\n      }, this)\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 75,\n      columnNumber: 7\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 63,\n    columnNumber: 5\n  }, this);\n};\n\n_s(Success, \"lOPZleBK38KIBvWqN6HfgRgyyr8=\", false, function () {\n  return [useDispatch, useLocation, useSelector, useSelector];\n});\n\n_c = Success;\nexport default Success;\n\nvar _c;\n\n$RefreshReg$(_c, \"Success\");","map":{"version":3,"sources":["D:/Dev/banhang/client/src/pages/Success.js"],"names":["useEffect","useState","useSelector","useDispatch","deleteCart","useLocation","userRequest","Link","setPoint","Success","dispatch","location","data","state","stripeData","cart","products","value","currentUser","user","point","level","orderId","setOrderId","console","log","deleCart","createOrder","res","post","userId","_id","map","item","productId","quantity","_quantity","amount","total","address","updateUser","newpoint","res1","put","height","display","flexDirection","alignItems","justifyContent","padding","marginTop"],"mappings":"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","sourcesContent":["import { useEffect, useState } from \"react\";\r\nimport { useSelector,useDispatch} from \"react-redux\";\r\nimport { deleteCart } from \"../redux/cartRedux\";\r\nimport { useLocation } from \"react-router\";\r\nimport { userRequest } from \"../requestMethod\";\r\nimport {Link} from \"react-router-dom\"\r\nimport {setPoint} from \"./../redux/userRedux\"\r\n\r\nconst Success = () => {\r\n  const dispatch=useDispatch();\r\n  const location = useLocation();\r\n  //in Cart.jsx I sent data and cart. Please check that page for the changes.(in video it's only data)\r\n  const data = location.state.stripeData;\r\n  const cart = location.state.products;\r\n  const value=location.state.value;\r\n  const currentUser = useSelector((state) => state.user.currentUser);\r\n  const point = useSelector((state) => state.user.point);\r\n  let level=point/1000000;\r\n  if(level<1) level=0;\r\n  if(1<=level&&level<2) level=1;\r\n  if(level<3&&level>=2) level=2\r\n  if(level>=3) level=3;\r\n  const [orderId, setOrderId] = useState(null);\r\n  console.log(currentUser)\r\n  const deleCart=()=>{\r\n    dispatch(deleteCart());\r\n  }\r\n  useEffect(() => {\r\n    const createOrder = async () => {\r\n      \r\n      try {\r\n        \r\n        const res = await userRequest.post(\"/orders\", {\r\n          userId: currentUser._id,\r\n          products: cart.products.map((item) => ({\r\n            productId: item._id,\r\n            quantity: item._quantity,\r\n          })),\r\n          amount: cart.total*(1-value)+50000-level*10000,\r\n          address: data,\r\n        });\r\n        console.log(res.data + \"null\")\r\n        setOrderId(res.data._id);\r\n      } catch {}\r\n    };\r\n    const updateUser= async ()=>{\r\n      try{\r\n       \r\n        const newpoint=currentUser.point+cart.total*(1-value)+50000-level*10000\r\n        dispatch(setPoint(newpoint));\r\n        const res1=await userRequest.put(`/users/${currentUser._id}`,{point:newpoint})\r\n        console.log(res1.data)\r\n      }\r\n      catch{\r\n        console.log('loi updateuser')\r\n      }\r\n    }\r\n    data && createOrder();\r\n    data&&updateUser();\r\n  }, [cart, data, currentUser]);\r\n\r\n  return (\r\n    <div\r\n      style={{\r\n        height: \"100vh\",\r\n        display: \"flex\",\r\n        flexDirection: \"column\",\r\n        alignItems: \"center\",\r\n        justifyContent: \"center\",\r\n      }}\r\n    >\r\n      {orderId\r\n        ? `Order has been created successfully. Your order number is ${orderId}`\r\n        : `Successfull. Your order is being prepared...`}\r\n      <Link to=\"/\" ><button style={{ padding: 10, marginTop: 20 }} onClick={deleCart}>Go to Homepage</button></Link>\r\n    </div>\r\n  );\r\n};\r\n\r\nexport default Success;"]},"metadata":{},"sourceType":"module"}